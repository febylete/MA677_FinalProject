<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Febriany Lete">

<title>Chapter 6. Empirical Bayes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Empirical Bayes_files/libs/clipboard/clipboard.min.js"></script>
<script src="Empirical Bayes_files/libs/quarto-html/quarto.js"></script>
<script src="Empirical Bayes_files/libs/quarto-html/popper.min.js"></script>
<script src="Empirical Bayes_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Empirical Bayes_files/libs/quarto-html/anchor.min.js"></script>
<link href="Empirical Bayes_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Empirical Bayes_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Empirical Bayes_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Empirical Bayes_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Empirical Bayes_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Chapter 6. Empirical Bayes</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Febriany Lete </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="historical-context" class="level2">
<h2 class="anchored" data-anchor-id="historical-context">Historical Context</h2>
<p><br>
The chapter on Empirical Bayes is situated within the broader historical context of statistical inference and Bayesian methods.</p>
<p>The term “empirical Bayes” was coined by Robbins in 1956, coinciding with the formulation of what is now known as formula (6.7). This marked a pivotal moment in statistical inference, as it introduced a practical approach for estimation when explicit prior information was unavailable. Robbins’ contribution laid the groundwork for empirical Bayes methods, which rely on observed data rather than predefined priors, making them particularly useful in scenarios where prior knowledge is scarce or difficult to specify.</p>
<p>Around the same time, Good and Toulmin proposed a solution to the missing-species problem, acknowledging the influence of Alan Turing on their ideas. This collaborative effort highlighted the interdisciplinary nature of statistical research and the importance of cross-disciplinary insights in advancing statistical methodologies.</p>
<p>Empirical Bayes estimates, such as those mentioned in formula (6.25), demonstrate the applicability of this approach in real-world scenarios. These estimates are not contingent on assumptions of independence among the observed variables but are sensitive to such assumptions, emphasizing the need for careful consideration of underlying assumptions in empirical Bayes analyses.</p>
<p>Corbet’s pioneering efforts in data collection, despite the challenges of pre-computer times, underscored the importance of reliable data in statistical inference. Today, statisticians often work with vast databases to extract meaningful insights, reflecting the evolution of data collection and analysis practices.</p>
<p>In subsequent years, Efron and Thisted applied empirical Bayes methods to analyze Shakespearean word counts, using linear programming techniques to estimate Shakespeare’s unseen vocabulary. Their work shed light on literary analysis and authorship attribution in historical texts. Similarly, empirical Bayes techniques were applied to analyze the potentially Shakespearean poem “Shall I die?” recovered in 1985, providing insights into authorship attribution in Elizabethan literature.</p>
<p>The historical context provided by these references highlights the interdisciplinary nature of statistical research and the practical significance of empirical Bayes methods in addressing diverse problems across various domains.</p>
<p>Empirical Bayes methods emerged as a pragmatic solution to the challenges of applying Bayesian inference in real-world settings where prior information may be scarce or difficult to specify. The empirical Bayes approach gained traction in the mid-20th century, particularly in fields such as biostatistics, genetics, and econometrics, where large datasets became increasingly available.</p>
<p>Bradley Efron and Trevor Hastie’s work on Empirical Bayes, as discussed in the book “Computer Age Statistical Inference,” reflects this historical trajectory. Efron and Hastie are prominent statisticians known for their contributions to empirical Bayes methods and their applications in various fields. Their work builds upon earlier developments in Bayesian statistics and empirical Bayes, offering practical tools and techniques for leveraging large datasets to make inference in a Bayesian framework.</p>
</section>
<section id="robbins-formula" class="level2">
<h2 class="anchored" data-anchor-id="robbins-formula">6.1 Robbins’ Formula</h2>
<p><strong>Main Points:</strong></p>
<ul>
<li><p>Robbins’ formula is a method used to estimate the expected number of claims or events based on past observations, without requiring prior knowledge of the underlying distribution. It is particularly relevant in scenarios where there is a large dataset of similar cases, making it feasible to derive Bayesian information empirically.</p></li>
<li><p>The formula is derived from Bayes’ rule, which is a fundamental concept in Bayesian statistics. Bayes’ rule allows us to update our beliefs about a parameter (in this case, the expected number of claims) based on observed data. In the context of Robbins’ formula, the parameter of interest is the expected number of claims made by a policyholder in a given year.</p></li>
<li><p>The key idea behind Robbins’ formula is to use the observed claim counts and their proportions to estimate the expected claim rate for policyholders. This estimation is done by considering the Poisson distribution, which is commonly used to model the number of events occurring in a fixed interval of time or space.</p></li>
</ul>
<p>The formula itself takes the form:</p>
<p>[ E{|x} = (x+1) ]</p>
<p>Where: - ( E{|x} ) is the estimated expected claim rate for a policyholder who has made ( x ) claims in the past year. - ( f(x) ) represents the proportion of policyholders who made ( x ) claims in the past year.</p>
<p>By applying this formula, insurance companies or other organizations can estimate the expected claim rate for individual policyholders based on their past claims history, even without having prior knowledge of the underlying distribution of claim rates.</p>
<ul>
<li>Robbins’ formula is considered significant because it provides a practical and effective method for making predictions in situations where traditional Bayesian methods may not be feasible due to a lack of prior information. Its empirical nature allows it to leverage the information contained within large datasets, making it a valuable tool for decision-making and risk assessment.</li>
</ul>
<p><strong>Comments and Notes:</strong></p>
<p>- Robbins’ formula provides a practical method for estimating future claim rates even without prior knowledge of the underlying distribution.</p>
<p>- The empirical nature of the formula underscores its relevance in the context of large datasets, where Bayesian principles can be applied effectively.</p>
<p>- The formula’s simplicity and effectiveness make it a valuable tool for insurance companies and other organizations dealing with similar prediction problems.</p>
<p><strong>Questions:</strong></p>
<p>1. How does Robbins’ formula overcome the challenge of not having prior knowledge of the distribution of claim rates?</p>
<p>2. What are the assumptions underlying the Poisson distribution in modeling claim rates, and how do they affect the accuracy of the estimates?</p>
<p>3. How does Robbins’ formula handle situations with small count numbers, as mentioned in the text?</p>
<p>4. What are the advantages and limitations of using a parametric approach, as described in the later part of the sub-chapter, compared to the empirical approach presented earlier?</p>
</section>
<section id="the-missing-species-problem" class="level2">
<h2 class="anchored" data-anchor-id="the-missing-species-problem">6.2 The Missing-Species Problem</h2>
<p><strong>Main Points:</strong></p>
<ol type="1">
<li><strong>Background and Problem Statement:</strong>
<ul>
<li>The sub-chapter introduces the “missing-species problem” through the context of Alexander Corbet’s butterfly trapping data. Corbet’s question was about estimating the number of new species he would capture if he continued trapping for an additional period.</li>
</ul></li>
<li><strong>Fisher’s Solution:</strong>
<ul>
<li>R. A. Fisher provided a solution to this problem, known as Fisher’s solution, which involves estimating the expected number of new species based on the observed trapping data.</li>
<li>Fisher’s key assumption is that the trapping rate for each species remains constant over time.</li>
</ul></li>
<li><strong>Formula and Calculation:</strong>
<ul>
<li>The expected number of new species ( E(t) ) is calculated using an integral equation, considering the probability of a species being unseen in the initial period but seen in the new period.</li>
<li>The formula for ( E(t) ) is expressed as: [ E(t) = S (_0^{} e^{-} (1 - e^{-t}) g() , d) ] Where:
<ul>
<li>( S ) is the total number of species, seen or unseen.</li>
<li>( ) represents the trapping rate parameter for each species.</li>
<li>( g() ) is the empirical density, representing the probability distribution of the trapping rates.</li>
<li>( t ) is the duration of the new trapping period.</li>
</ul></li>
</ul></li>
<li><strong>Example:</strong>
<ul>
<li>An example is provided using Corbet’s butterfly trapping data. If Corbet specified ( t = 1/2 ), then the expected number of new species ( E(t) ) can be calculated using the formula.</li>
<li>The formula yields an estimate of the expected number of new species based on the observed trapping data.</li>
</ul></li>
</ol>
<p><strong>Example Calculation:</strong> - Given the butterfly trapping data, let’s assume ( t = 1/2 ) year for the new trapping period. - We can use the observed trapping counts ( y_x ) from Table 6.2 to calculate the expected number of new species using Fisher’s formula. - Substituting the values into the formula, we can calculate ( E(1/2) ), which represents the expected number of new species for a trapping period of ( 1/2 ) year.</p>
<p><strong>Comments and Notes:</strong></p>
<ul>
<li>Fisher’s solution provides a practical and data-driven method for estimating the number of new species or items in various scenarios, beyond just butterfly trapping data.</li>
<li>The formula incorporates the observed data and assumes a constant trapping rate for each species over time.</li>
<li>While the formula provides useful estimates, it’s important to consider its limitations, particularly its stability for larger time periods and the assumptions made about the trapping process.</li>
</ul>
<p><strong>Questions:</strong></p>
<ol type="1">
<li><p>How does Fisher’s formula incorporate the probability of a species being unseen in the initial period but seen in the new period?</p></li>
<li><p>How does Fisher’s solution address the challenge of estimating the number of new species without prior knowledge of the underlying distribution?</p></li>
<li><p>What are some potential limitations or assumptions of Fisher’s solution, and how might they affect the accuracy of the estimates?</p></li>
</ol>
</section>
<section id="a-medical-example" class="level2">
<h2 class="anchored" data-anchor-id="a-medical-example">6.3 A Medical Example</h2>
<p><strong>Main Points:</strong></p>
<ol type="1">
<li><strong>Introduction to the Medical Study:</strong>
<ul>
<li>The sub-chapter discusses a medical study involving cancer surgery, specifically the removal of surrounding lymph nodes along with the primary target.</li>
<li>The study comprises 844 surgeries, each reporting the number of nodes removed ((n_k)) and the number of nodes found positive ((x_k)).</li>
<li>The ratios of positive nodes to total nodes removed ((p_k = )) are described in a histogram, with a large proportion of them being zero.</li>
</ul></li>
<li><strong>Binomial Distribution Model:</strong>
<ul>
<li>The study assumes that each patient has a true probability ((_k)) of a node being positive, and the results of nodal examination occur independently of each other.</li>
<li>The number of positive nodes ((x_k)) follows a binomial distribution ((x_k (n_k, _k))), where (n_k) represents the total number of nodes removed for patient (k).</li>
</ul></li>
<li><strong>Bayesian Analysis and Empirical Bayes Approach:</strong>
<ul>
<li>A Bayesian analysis typically begins with the assumption of a prior density ((g())) for the (_k) values.</li>
<li>However, due to the lack of prior knowledge about (g()), an empirical Bayes approach is adopted.</li>
<li>In the empirical Bayes approach for this study, it’s assumed that the logarithm of (g()) follows a fourth-degree polynomial in ().</li>
</ul></li>
<li><strong>Parameter Estimation:</strong>
<ul>
<li>The parameter vector (= (_1, _2, _3, _4)) determines (g()) based on the assumed polynomial form.</li>
<li>The maximum likelihood estimate of () is obtained by maximizing the likelihood function.</li>
</ul></li>
<li><strong>Clinical Implications:</strong>
<ul>
<li>The study aims to assess the prognostic significance of the positive node ratios ((p_k)) in determining the need for follow-up therapy.</li>
<li>A threshold of () is used to indicate poor prognosis, suggesting more aggressive follow-up therapy for patients with higher positive node ratios.</li>
</ul></li>
</ol>
<p><strong>Example and Clinical Interpretation:</strong> - The example provided in the sub-chapter involves analyzing the positive node ratios for individual patients and assessing their prognosis based on the estimated probabilities ((_k)). - By comparing the estimated probabilities to the threshold of (0.50), patients are categorized into different risk groups, informing the need for follow-up therapy.</p>
<p><strong>Comments and Notes:</strong></p>
<ul>
<li>The medical example demonstrates the application of empirical Bayes methods in analyzing complex datasets, where traditional Bayesian analysis may not be feasible due to a lack of prior information.</li>
<li>The study highlights the importance of statistical methods in informing clinical decision-making and risk assessment in medical practice.</li>
</ul>
<p><strong>Potential Questions:</strong></p>
<ol type="1">
<li>How does the binomial distribution model capture the probability of a node being positive in cancer surgery?</li>
<li>How do the estimated probabilities ((_k)) inform clinical decisions regarding follow-up therapy for cancer patients?</li>
<li>What are some potential challenges or limitations associated with the empirical Bayes approach in medical studies, and how can they be addressed?</li>
</ol>
</section>
<section id="indirect-evidence-1" class="level2">
<h2 class="anchored" data-anchor-id="indirect-evidence-1">6.4 Indirect Evidence 1</h2>
<p><strong>Main Points:</strong></p>
<ol type="1">
<li><strong>Definition of Statistical Argument:</strong>
<ul>
<li>A statistical argument involves combining many small pieces of evidence, often contradictory, to produce an overall conclusion.</li>
<li>In clinical trials, for example, the efficacy of a new drug is not assessed based on curing every patient but on accumulating convincing evidence of its effectiveness over a group.</li>
</ul></li>
<li><strong>Direct vs.&nbsp;Indirect Evidence:</strong>
<ul>
<li>Direct statistical evidence involves each subject’s success or failure directly impacting the question of interest, as seen in clinical trials.</li>
<li>Direct evidence, interpreted using frequentist methods, was dominant in the 20th century and is strongly linked to scientific objectivity.</li>
</ul></li>
<li><strong>Bayesian Inference and Indirect Evidence:</strong>
<ul>
<li>Bayesian inference provides a theoretical framework for incorporating indirect evidence, such as a doctor’s prior experience, represented by a prior density (g()).</li>
<li>Asserting a prior density (g()) suggests the relevance of past data to the current case.</li>
</ul></li>
<li><strong>Empirical Bayes Approach:</strong>
<ul>
<li>Empirical Bayes removes the need for a prior density by relying on the relevance of “other” cases in a large dataset.</li>
<li>For example, in estimating a patient’s success rate in a clinical trial, empirical Bayes uses the success rates of other patients as a basis for estimation.</li>
<li>The sub-chapter illustrates the empirical Bayes estimate calculation for a patient in a clinical trial.</li>
</ul></li>
<li><strong>Shift towards Indirect Evidence:</strong>
<ul>
<li>Changes in 21st-century statistics are largely demand-driven, responding to massive datasets enabled by modern scientific equipment.</li>
<li>Philosophically, there has been an increased acceptance of indirect evidence, particularly in empirical Bayes and objective Bayes applications.</li>
<li>False discovery rates, discussed in Chapter 15, represent a significant shift towards using indirect evidence in hypothesis testing.</li>
</ul></li>
</ol>
<p><strong>Comments and Notes:</strong></p>
<ul>
<li>The sub-chapter highlights the importance of indirect evidence in statistical inference, particularly in contexts where direct evidence may be limited or impractical.</li>
<li>It discusses the philosophical and methodological changes in statistics, emphasizing the increasing acceptance of indirect evidence-driven approaches.</li>
</ul>
<p><strong>Potential Questions:</strong></p>
<ol type="1">
<li>How does the definition of a statistical argument emphasize the role of combining contradictory evidence?</li>
<li>What role does Bayesian inference play in incorporating indirect evidence, and how does it differ from frequentist methods?</li>
<li>How does the empirical Bayes approach address the challenge of estimating parameters without relying on explicit prior information?</li>
</ol>
</section>
<section id="implications-for-statistical-practice" class="level2">
<h2 class="anchored" data-anchor-id="implications-for-statistical-practice">Implications For Statistical Practice</h2>
<p>The material covered in the chapter on empirical Bayes has several implications for statistical practice:</p>
<ol type="1">
<li><p><strong>Handling Limited Prior Information:</strong> Empirical Bayes methods provide a practical approach for estimation when explicit prior information is limited or difficult to specify. This is particularly relevant in fields where prior knowledge is scarce or uncertain, allowing statisticians to make informed decisions based on observed data.</p></li>
<li><p><strong>Utilizing Large Datasets:</strong> With the increasing availability of large datasets, empirical Bayes methods offer a way to leverage this wealth of information for estimation and inference. By analyzing patterns and trends within these datasets, statisticians can derive valuable insights and make more accurate predictions.</p></li>
<li><p><strong>Addressing Missing Data Problems:</strong> Empirical Bayes techniques can help address missing data problems by using information from similar cases to impute missing values. This allows for more robust analyses and reduces the impact of missing data on statistical inference.</p></li>
<li><p><strong>Improving Decision Making:</strong> By incorporating empirical Bayes methods into statistical practice, decision makers can make more informed choices based on a better understanding of uncertainty and variability in the data. This can lead to more effective strategies and interventions in various fields, from healthcare to finance.</p></li>
<li><p><strong>Enhancing Predictive Modeling:</strong> Empirical Bayes approaches can improve the performance of predictive models by incorporating information from similar observations. This allows for more accurate predictions and better decision support in areas such as risk assessment and forecasting.</p></li>
</ol>
<p>Overall, the material in the chapter underscores the practical utility of empirical Bayes methods in statistical practice, offering valuable tools and techniques for estimation, inference, and decision making in a wide range of applications.</p>
</section>
<section id="example-for-empirical-bayes" class="level2">
<h2 class="anchored" data-anchor-id="example-for-empirical-bayes">Example for Empirical Bayes</h2>
<p>For a simple example to illustrate empirical Bayes estimation using a dataset of exam scores. We’ll assume that we have exam scores from multiple students and want to estimate the true mean score for each student based on their observed scores and the overall distribution of scores.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>num_students <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>num_exams <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>true_mean_scores <span class="ot">&lt;-</span> <span class="fu">runif</span>(num_students, <span class="at">min =</span> <span class="dv">60</span>, <span class="at">max =</span> <span class="dv">90</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>exam_scores <span class="ot">&lt;-</span> <span class="fu">sapply</span>(true_mean_scores, <span class="cf">function</span>(mu) <span class="fu">rnorm</span>(num_exams, <span class="at">mean =</span> mu, <span class="at">sd =</span> <span class="dv">5</span>))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>exam_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">StudentID =</span> <span class="dv">1</span><span class="sc">:</span>num_students, <span class="at">true_mean_score =</span> true_mean_scores, exam_scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s implement empirical Bayes estimation to estimate the true mean score for each student:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:MASS':

    select</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to compute empirical Bayes estimate</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>empirical_bayes <span class="ot">&lt;-</span> <span class="cf">function</span>(scores) {</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(scores)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply empirical Bayes estimation for each student</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>exam_data <span class="ot">&lt;-</span> exam_data <span class="sc">%&gt;%</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">empirical_bayes_estimate =</span> <span class="fu">rowMeans</span>(<span class="fu">t</span>(exam_scores)))</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a ggplot to visualize true mean scores vs empirical Bayes estimates</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(exam_data, <span class="fu">aes</span>(<span class="at">x =</span> true_mean_score, <span class="at">y =</span> empirical_bayes_estimate)) <span class="sc">+</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"True Mean Score"</span>, <span class="at">y =</span> <span class="st">"Empirical Bayes Estimate"</span>, </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"True Mean Scores vs Empirical Bayes Estimates"</span>) <span class="sc">+</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Empirical-Bayes_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In this example, we first simulate a dataset with 100 students and 5 exam scores for each student. We then define a function <code>empirical_bayes</code> to perform empirical Bayes estimation for a given set of exam scores. This function fits a normal distribution to the observed scores and extracts the estimated mean as the empirical Bayes estimate.</p>
<p>Finally, we apply the <code>empirical_bayes</code> function to each student’s exam scores using <code>sapply</code>, and store the resulting empirical Bayes estimates in a new column <code>empirical_bayes_estimate</code> in the dataset.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ol type="1">
<li><p>Bradley Efron, Trevor Hastie (2016). Computer Age Statistical Inference: Algorithms, Evidence, and Data Science. Cambridge University Press.</p></li>
<li><p>Bayes, T. (1763). An essay towards solving a problem in the doctrine of chances. Philosophical Transactions of the Royal Society of London, 53, 370-418.</p></li>
<li><p>Laplace, P. S. (1814). Essai philosophique sur les probabilités.</p></li>
<li><p>Efron, B. (2010). Large-scale inference: empirical Bayes methods for estimation, testing, and prediction. Cambridge University Press.</p></li>
<li><p>Hastie, T., Tibshirani, R., &amp; Friedman, J. (2009). The elements of statistical learning: data mining, inference, and prediction. Springer Science &amp; Business Media.</p></li>
<li><p>Chat GPT.</p></li>
</ol>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>